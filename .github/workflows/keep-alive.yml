name: Keep Repo Alive (Manual)
on:
  workflow_dispatch:
  schedule:
    - cron: '00 13 * * *'

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    permissions:
      contents: write # å¿…é¡»æä¾›å†™å…¥æƒé™
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        # å¦‚æœä½ çš„ä»“åº“æ˜¯ç§æœ‰çš„ï¼Œæˆ–è€…ä½ æƒ³ç”¨ç‰¹å®šç”¨æˆ·æäº¤ï¼Œä»ç„¶å»ºè®®ä½¿ç”¨ PAT
        # with:
        #   token: ${{ secrets.PAT }}

      - name: Create or update a file to trigger commit
        run: |
          # åˆ›å»ºä¸€ä¸ªæ—¶é—´æˆ³æ–‡ä»¶ï¼Œæ¯æ¬¡è¿è¡Œå†…å®¹éƒ½ä¼šå˜åŒ–ï¼Œç¡®ä¿æœ‰ä¸œè¥¿å¯æäº¤
          date > last_updated.txt

      - name: Commit and push changes
        run: |
          # é…ç½® git ç”¨æˆ·
          git config --global user.name 'xyh4ck'
          git config --global user.email '15534996948@163.com'
          
          # æ·»åŠ æ›´æ”¹å¹¶æäº¤
          git add last_updated.txt
          # ä½¿ç”¨ "git diff-index --quiet HEAD" æ£€æŸ¥æ˜¯å¦æœ‰æ”¹åŠ¨
          # å¦‚æœæ²¡æœ‰æ”¹åŠ¨ï¼ˆæ¯”å¦‚æ–‡ä»¶å†…å®¹æ²¡å˜ï¼‰ï¼Œå°±ä¸æ‰§è¡Œ commit å’Œ pushï¼Œé¿å…æŠ¥é”™
          if ! git diff-index --quiet HEAD; then
            git commit -m "ğŸš§ keepalive: auto-commit on $(date)"
            git push
          else
            echo "No changes to commit."
          fi
